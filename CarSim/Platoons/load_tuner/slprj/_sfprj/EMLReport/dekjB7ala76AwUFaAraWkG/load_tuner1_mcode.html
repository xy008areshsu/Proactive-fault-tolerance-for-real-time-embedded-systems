<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> <span class="var type0" id="S2T0U3">X</span>  = load_tuner( <span class="var type1" id="S3T1U6">candidate_set</span>, <span class="var type1" id="S4T3U7">num_of_tasks</span> )</span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">%LOAD_BALANCER: balancing the cpu load based on the trade-off between</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">%quality of control and (thermal) reliability</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4"> 4</a></span><span class="line"><span class="comment">%Output: a complete task set, each task has (period, estimated avg and</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5"> 5</a></span><span class="line"><span class="comment">%worst case execution time, and how many copies). the scheduling policies</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6"> 6</a></span><span class="line"><span class="comment">%is to choose the coolest processors (cores) each time</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7"> 7</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8"> 8</a></span><span class="line"><span class="mxinfo " id="T2:U3"><span class="var type1" id="S5T2U10">costs</span> = <span class="mxinfo " id="T2:U5">zeros(<span class="mxinfo " id="T3:U6">size(<span class="var type1" id="S3T1U15">candidate_set</span>, 1)</span>, 1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9"> 9</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S8T3U20">i</span> = <span class="mxinfo " id="T2:U9"><span class="mxinfo " id="T3:U10">1</span> : size(<span class="var type1" id="S5T2U25">costs</span>, 1)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10">10</a></span><span class="line">    <span class="mxinfo " id="T3:U12"><span class="mxinfo " id="T3:U13"><span class="var type1" id="S5T2U30">costs</span>(<span class="var type1" id="S8T3U31">i</span>)</span> = <span class="mxinfo " id="T3:U16"><span class="var type1" id="S3T1U33">candidate_set</span>(<span class="var type1" id="S8T3U34">i</span>,<span class="mxinfo " id="T3:U19">3</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11">11</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12">12</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13">13</a></span><span class="line"><span class="mxinfo " id="T10:U20"><span class="var type1" id="S9T10U38">intcon</span> = <span class="mxinfo " id="T10:U22">ones(<span class="mxinfo " id="T3:U23">1</span>, <span class="mxinfo " id="T3:U24">size(<span class="var type1" id="S3T1U44">candidate_set</span>, 1)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14">14</a></span><span class="line"><span class="mxinfo " id="T10:U26"><span class="var type1" id="S11T10U48">A</span> = <span class="mxinfo " id="T10:U28">zeros(<span class="mxinfo " id="T3:U29">1</span>, <span class="mxinfo " id="T3:U30">size(<span class="var type1" id="S3T1U54">candidate_set</span>, 1)</span>)</span></span>;      <span class="comment">% RM scheduling for a single core, total utilization should be less than m(2^(1/m) - 1)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15">15</a></span><span class="line"><span class="mxinfo " id="T3:U32"><span class="var type1" id="S12T3U58">b</span> = <span class="mxinfo " id="T3:U34">zeros(1, 1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16">16</a></span><span class="line"><span class="mxinfo " id="T11:U35"><span class="var type1" id="S13T11U65">Aeq</span> = <span class="mxinfo " id="T11:U37">zeros(<span class="var type1" id="S4T3U68">num_of_tasks</span>, <span class="mxinfo " id="T3:U39">size(<span class="var type1" id="S3T1U71">candidate_set</span>, 1)</span>)</span></span>;   <span class="comment">% each task just can pick one candidate: X_A1 + X_A2 + X_A3 + X_A4 = 1; X_B1 + X_B2 + X_B3 + X_B4 = 1</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17">17</a></span><span class="line"><span class="mxinfo " id="T12:U41"><span class="var type1" id="S14T12U75">beq</span> = <span class="mxinfo " id="T12:U43">zeros(<span class="var type1" id="S4T3U78">num_of_tasks</span>, 1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18">18</a></span><span class="line"><span class="mxinfo " id="T2:U45"><span class="var type1" id="S15T2U82">LB</span> = <span class="mxinfo " id="T2:U47">zeros(<span class="mxinfo " id="T3:U48">size(<span class="var type1" id="S3T1U87">candidate_set</span>, 1)</span>, 1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19">19</a></span><span class="line"><span class="mxinfo " id="T2:U50"><span class="var type1" id="S16T2U92">UB</span> = <span class="mxinfo " id="T2:U52">ones(<span class="mxinfo " id="T3:U53">size(<span class="var type1" id="S3T1U97">candidate_set</span>, 1)</span>, 1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20">20</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21">21</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S8T3U102">i</span> = <span class="mxinfo " id="T12:U56"><span class="mxinfo " id="T3:U57">1</span> : <span class="var type1" id="S4T3U105">num_of_tasks</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22">22</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S17T3U108">j</span> = <span class="mxinfo " id="T12:U60"><span class="mxinfo " id="T3:U61"><span class="mxinfo " id="T3:U62">(<span class="mxinfo " id="T3:U63"><span class="var type1" id="S8T3U114">i</span> - <span class="mxinfo " id="T3:U65">1</span></span>) * (<span class="mxinfo " id="T3:U66"><span class="mxinfo " id="T3:U67">size(<span class="var type1" id="S3T1U120">candidate_set</span>, 1)</span> / <span class="var type1" id="S4T3U122">num_of_tasks</span></span>)</span> + <span class="mxinfo " id="T3:U70">1</span></span> : <span class="mxinfo " id="T3:U71"><span class="var type1" id="S8T3U125">i</span> * (<span class="mxinfo " id="T3:U73"><span class="mxinfo " id="T3:U74">size(<span class="var type1" id="S3T1U130">candidate_set</span>, 1)</span> / <span class="var type1" id="S4T3U132">num_of_tasks</span></span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23">23</a></span><span class="line">        <span class="mxinfo " id="T3:U77"><span class="mxinfo " id="T3:U78"><span class="var type1" id="S13T11U136">Aeq</span>(<span class="var type1" id="S8T3U137">i</span>, <span class="var type1" id="S17T3U138">j</span>)</span> = <span class="mxinfo " id="T3:U82">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24">24</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25">25</a></span><span class="line">    <span class="mxinfo " id="T3:U83"><span class="mxinfo " id="T3:U84"><span class="var type1" id="S14T12U143">beq</span>(<span class="var type1" id="S8T3U144">i</span>, <span class="mxinfo " id="T3:U87">1</span>)</span> = <span class="mxinfo " id="T3:U88">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26">26</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27">27</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28">28</a></span><span class="line"><span class="mxinfo " id="T3:U89"><span class="var type1" id="S18T3U149">load_threshold</span> = <span class="mxinfo " id="T3:U91"><span class="var type1" id="S4T3U151">num_of_tasks</span> * (<span class="mxinfo " id="T3:U93"><span class="mxinfo " id="T3:U94"><span class="mxinfo " id="T3:U95">2</span>^(<span class="mxinfo " id="T3:U96"><span class="mxinfo " id="T3:U97">1</span>/<span class="var type1" id="S4T3U159">num_of_tasks</span></span>)</span> - <span class="mxinfo " id="T3:U99">1</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29">29</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S17T3U163">j</span> = <span class="mxinfo " id="T2:U101"><span class="mxinfo " id="T3:U102">1</span> : size(<span class="var type1" id="S3T1U168">candidate_set</span>, 1)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30">30</a></span><span class="line">    <span class="mxinfo " id="T3:U104"><span class="mxinfo " id="T3:U105"><span class="var type1" id="S11T10U173">A</span>(<span class="mxinfo " id="T3:U107">1</span>, <span class="var type1" id="S17T3U175">j</span>)</span> = <span class="mxinfo " id="T3:U109"><span class="mxinfo " id="T3:U110"><span class="var type1" id="S3T1U178">candidate_set</span>(<span class="var type1" id="S17T3U179">j</span>, <span class="mxinfo " id="T6:U113">2</span>)</span> / <span class="mxinfo " id="T3:U114"><span class="var type1" id="S3T1U182">candidate_set</span>(<span class="var type1" id="S17T3U183">j</span>, <span class="mxinfo " id="T6:U117">1</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31">31</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32">32</a></span><span class="line"><span class="mxinfo " id="T3:U118"><span class="var type1" id="S12T3U188">b</span>(<span class="mxinfo " id="T6:U120">1</span>, <span class="mxinfo " id="T6:U121">1</span>) = <span class="var type1" id="S18T3U191">load_threshold</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33">33</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34">34</a></span><span class="line"><span class="var type0" id="S2T0U194">X</span> = <span class="message error" id="M1F1C">intlinprog(<span class="var type1" id="S5T2U197">costs</span>, <span class="var type1" id="S9T10U198">intcon</span>, <span class="var type1" id="S11T10U199">A</span>, <span class="var type1" id="S12T3U200">b</span>, <span class="var type1" id="S13T11U201">Aeq</span>, <span class="var type1" id="S14T12U202">beq</span>, <span class="var type1" id="S15T2U203">LB</span>, <span class="var type1" id="S16T2U204">UB</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35">35</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36">36</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37">37</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,38" id="srcline38">38</a></span><span class="line"></span></span>
</pre>
